{% extends "base.html" %}
{% block title %}{{ job.title }} ‚Äî HireX{% endblock %}
{% block content %}

<div class="container mt-4">
  <nav aria-label="breadcrumb" data-aos="fade-down">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Jobs</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{ job.title }}</li>
    </ol>
  </nav>

  <div class="row g-4">
    <div class="col-lg-8">
      <div class="company-banner rounded mb-3 p-4 text-white"
        style="background-image: linear-gradient(90deg, rgba(13,110,253,0.9), rgba(13,202,240,0.9));">
        <div class="d-flex align-items-center">
          <img src="{{ job.logo_path or 'https://images.unsplash.com/photo-1542744173-8e7e53415bb0?q=80&w=80&auto=format&fit=crop' }}"
            alt="company" class="company-logo me-3 rounded">
          <div>
            <h4 class="mb-0">{{ job.company_name }}</h4>
            <small class="d-block">{{ job.company_description or 'A reputed organization' }}</small>
          </div>
          <div class="ms-auto">
            {% if job.website %}
            <a class="btn btn-sm btn-light" href="{{ job.website }}" target="_blank">Visit Site</a>
            {% endif %}
          </div>
        </div>
      </div>

      <h2 class="fw-bold">{{ job.title }}</h2>
      <div class="text-muted mb-3">{{ job.location }} ‚Ä¢ {{ job.job_type }} ‚Ä¢ {{ job.experience_level }} ‚Ä¢
        {{ job.salary_range }}</div>

      <div class="mb-4">
        <h5>Description</h5>
        <p>{{ job.description }}</p>
      </div>

      <div class="mb-4">
        <h5>Skills Required</h5>
        {% for s in job.skills.split(',') if job.skills %}
        <span class="badge bg-info text-dark me-1">{{ s.strip() }}</span>
        {% endfor %}
      </div>

      <div class="mt-4">
        <h5>Similar Jobs</h5>
        <div id="similarJobs" class="row g-3"></div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="col-lg-4">
      <div class="card p-3 mb-3" data-aos="fade-left">
        <h5>Quick Apply</h5>
        <p class="small text-muted">Submit your application instantly.</p>
        <button class="btn btn-gradient w-100" data-bs-toggle="modal" data-bs-target="#applyModal">
          Apply Now
        </button>
      </div>

      <div class="card p-3 mb-3" data-aos="fade-left">
        <h6>Job Insights</h6>
        <ul class="list-unstyled small mb-0">
          <li>üìÖ Posted: {{ job.post_date }}</li>
          <li>üí∞ Salary: {{ job.salary_range or '‚Äî' }}</li>
          <li>üßë‚Äçüíº Experience: {{ job.experience_level }}</li>
        </ul>
      </div>
    </aside>
  </div>
</div>

<!-- Apply Modal -->
<div class="modal fade" id="applyModal" tabindex="-1" aria-labelledby="applyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-semibold" id="applyModalLabel">Apply for {{ job.title }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">

        <form id="applyForm" method="post" action="{{ url_for('apply', id=job.id) }}" enctype="multipart/form-data">
  <div class="mb-3">
    <label>Full Name</label>
    <input name="name" class="form-control" required>
  </div>
  <div class="mb-3">
    <label>Email</label>
    <input name="email" type="email" class="form-control" required>
  </div>
  <div class="mb-3">
    <label>Phone</label>
    <input name="phone" class="form-control">
  </div>
  <div class="mb-3">
    <label>Resume (PDF/DOC/DOCX)</label>
    <input type="file" name="resume" accept=".pdf,.doc,.docx" class="form-control" required>
  </div>
  <div class="mb-3">
    <label>Cover Letter</label>
    <textarea name="cover" class="form-control" rows="3"></textarea>
  </div>
  <button type="submit" class="btn btn-gradient w-100">Submit</button>
</form>


      </div>
    </div>
  </div>
</div>

{% block scripts %}
<script>
// Load similar jobs dynamically
fetch("/api/jobs?skills={{ job.skills|urlencode }}&limit=4")
  .then(r => r.json())
  .then(data => {
    const cont = document.getElementById('similarJobs');
    if (!data.length) {
      cont.innerHTML = '<p class="text-muted">No similar jobs found.</p>';
      return;
    }
    cont.innerHTML = data.map(j => `
      <div class="col-12">
        <div class="card p-2">
          <a href="/job/${j.id}" class="stretched-link fw-bold text-decoration-none">${j.title}</a>
          <div class="small text-muted">${j.company_name} ‚Ä¢ ${j.location}</div>
        </div>
      </div>`).join('');
  });

// Show success alert on form submit
document.getElementById("applyForm").addEventListener("submit", e => {
  Swal.fire({
    title: "Application Submitted!",
    text: "Your application has been sent successfully.",
    icon: "success",
    confirmButtonColor: "#1b1f3b"
  });
});
</script>
{% endblock %}
{% endblock %}
